{% extends 'base.html' %}
{% load post_tags group_tags %}

{% block group %}
  <li>
    <a href="{% url 'group:group_create' %}" class="nav-link px-2 link-body-emphasis">Create Group</a>
  </li>
{% endblock %}
{% block post %}
  <li>
    <a href="{% url 'post:post_list' %}" class="nav-link px-2 link-body-emphasis">Posts</a>
  </li>
{% endblock %}

{% block content %}

{% if is_owner %}
  <div class="container pt-5">
    <h1 class="text-center">Group Detail</h1>
    <br /><br />
    <div class="card mb-3">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>

          <h5 class="card-title mb-1">{{ group.name }}</h5>
          <p class="card-text">{{ group.description }}</p>
          <p class="text-muted small">
            ğŸ‘¥ {{ group.num_member }} Member{{ group.num_member|pluralize }}
          </p>

          {% if group|user_joined_group:request.user %}
            <form action="{% url 'group:member_group' pk=group.id %}" method="post" class="mt-3">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-outline-danger">Leave Group</button>
            </form>
          {% else %}
            <form action="{% url 'group:member_group' pk=group.id %}" method="post" class="mt-3">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-outline-success">Join Group</button>
            </form>
          {% endif %}

        </div>
        <div>
          <a href="{% url 'group:group_update' pk=group.id %}" class="btn btn-sm btn-outline-primary me-2" title="Edit">
            <i class="fas fa-edit"></i>
          </a>
          <a href="{% url 'group:group_delete' pk=group.id %}" class="btn btn-sm btn-outline-danger" title="Delete">
            <i class="fas fa-trash-alt"></i>
          </a>
        </div>
      </div>
    </div>
  </div>
{% elif user.is_authenticated %}
  <div class="container text-center pt-5">
    <h1>Group Detail</h1>
    <br /><br />
    <div class="card mb-3">
      <div class="card-body">
        <h5 class="card-title">{{ group.name }}</h5>
        <p class="card-text">{{ group.description }}</p>
        <p class="text-muted small">
          ğŸ‘¥ {{ group.num_member }} Member{{ group.num_member|pluralize }}
        </p>

        {% if group|user_joined_group:request.user %}
          <form action="#" method="post" class="mt-3">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-danger">Leave Group</button>
          </form>
        {% else %}
          <form action="#" method="post" class="mt-3">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-success">Join Group</button>
          </form>
        {% endif %}
      </div>
    </div>
  </div>
{% else %}
  <div class="container text-center pt-5">
    <h1>Group Detail</h1>
    <br /><br />
    <div class="card mb-3">
      <div class="card-body">
        <h5 class="card-title">{{ group.name }}</h5>
        <p class="card-text">{{ group.description }}</p>
        <p class="text-muted small">
          ğŸ‘¥ {{ group.num_member }} Member{{ group.num_member|pluralize }}
        </p>
      </div>
    </div>
  </div>
{% endif %}

<div class="container text-center pt-5">

  <h2 class="mb-4">Posts in this Group</h2>

  {% if posts %}
    {% for post in posts %}
      <div class="card mb-3">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="mb-1">{{post.user.username}}</h5>
              <small class="text-muted">{{post.created_at}}</small>
            </div>
            {% if post.user == request.user %}
            <div>
              <a href="{% url 'post:post_update' pk=post.id %}" class="btn btn-sm btn-outline-primary me-2" title="Edit">
                <i class="fas fa-edit"></i>
              </a>
              <a href="{% url 'post:post_delete' pk=post.id %}" class="btn btn-sm btn-outline-danger" title="Delete">
                <i class="fas fa-trash-alt"></i>
              </a>
            </div>
            {% endif %}
          </div>

          <a href="{% url 'post:post_detail' pk=post.id %}" class="text-decoration-none text-dark">
            <p class="mt-3">
              {{post.content}}
            </p>

            {% if post.image %}
              <img src="{{ post.image.url }}"
                  class="img-fluid rounded"
                  alt="Developer workspace dummy image">
            {% endif %}
          </a>
        </div>

        <div class="card-footer bg-white border-top">
          <div class="d-flex justify-content-around">
            {% if user.is_authenticated %}
              <form action="{% url 'post:like_post' pk=post.id %}" method="post" class="d-inline">
                {% csrf_token %}
                <button type="submit"
                  class="
                    btn btn-sm
                    {% if post|user_liked_post:request.user %}
                      btn-success
                    {% else %}
                      btn-outline-success
                    {% endif %}">

                  ğŸ‘ {{ post.num_likes }} Like{{ post.num_likes|pluralize }}
                </button>
              </form>
            {% else %}
              <form action="{% url 'post:like_post' pk=post.id %}" method="post" class="d-inline">
                {% csrf_token %}
                <button type="submit"
                  class="btn btn-sm btn-outline-success">
                  ğŸ‘ {{ post.num_likes }} Like{{ post.num_likes|pluralize }}
                </button>
              </form>
            {% endif %}
            <a href="{% url 'post:post_detail' pk=post.id %}" class="btn btn-sm btn-outline-secondary">
              ğŸ’¬ Comment
            </a>
          </div>
        </div>

      </div>
    {% endfor %}
  {% else %}
    <p class="text-muted">No posts have been added to this group yet.</p>
  {% endif %}
</div>

{% endblock %}
